{
  "comments": [
    {
      "key": {
        "uuid": "1a622d24_f08b1466",
        "filename": "mdsalutil/mdsalutil-api/src/main/java/org/opendaylight/genius/datastoreutils/DataStoreJobCoordinator.java",
        "patchSetId": 1
      },
      "lineNbr": 85,
      "author": {
        "id": 5278
      },
      "writtenOn": "2016-12-19T07:15:20Z",
      "side": 1,
      "message": "Since jobs_pending counter already exists, we can simply reuse it for unit testing purpose.",
      "revId": "3dd38ef8a108839a4ba5e49c3fe8c96b0ec73ac8",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1a622d24_30ed8c26",
        "filename": "mdsalutil/mdsalutil-api/src/main/java/org/opendaylight/genius/datastoreutils/DataStoreJobCoordinator.java",
        "patchSetId": 1
      },
      "lineNbr": 123,
      "author": {
        "id": 5278
      },
      "writtenOn": "2016-12-19T07:15:20Z",
      "side": 1,
      "message": "This method is invoked after the main worker task is completed from MainTask/JobCallback/RollbackTask. So Let us place jobs_pending.dec() here so that it tells us how many jobs are actually completed.\n\nThe main purpose of clearJob is to set executingEntry to null in JobQueue so that waitingEntries (of the same job key) get a chance to get executed.",
      "revId": "3dd38ef8a108839a4ba5e49c3fe8c96b0ec73ac8",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1a622d24_e1a50848",
        "filename": "mdsalutil/mdsalutil-api/src/main/java/org/opendaylight/genius/datastoreutils/DataStoreJobCoordinator.java",
        "patchSetId": 1
      },
      "lineNbr": 123,
      "author": {
        "id": 6365
      },
      "writtenOn": "2016-12-19T20:47:26Z",
      "side": 1,
      "message": "jobs_pending is a \"state\" counter and jobs_cleared is a \"regular counter\".\nState counter means that it will be printed only if between two print intervals, there is a change in the counter value. For example, X calls to inc() and X calls to dec() ,in a single print interval , will not be printed, therefore it\u0027s not a reliable way to measure queue size.\n\nThe regular counter, jobs_cleared behaves like it is expected from a \"counter\", it will display the number of changes. It is a reliable way to measure how much jobs have been finished (but is not the right way to measure queue size).\n\nThe two counters track different information.",
      "parentUuid": "1a622d24_30ed8c26",
      "revId": "3dd38ef8a108839a4ba5e49c3fe8c96b0ec73ac8",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1a622d24_0763f4dc",
        "filename": "mdsalutil/mdsalutil-api/src/main/java/org/opendaylight/genius/datastoreutils/DataStoreJobCoordinator.java",
        "patchSetId": 1
      },
      "lineNbr": 123,
      "author": {
        "id": 5278
      },
      "writtenOn": "2016-12-20T04:47:08Z",
      "side": 1,
      "message": "Not sure I have understood your comment.\n\nMy assumption of jobs_pending counter is: Increment the counter whenever a job is enqueued and decrement it after the job is completed. This exactly tells us how many jobs are actually pending with DJC. This would be useful for writing junits around DJC.\n\nDo we really need to have jobs_cleared counter ? \nYes, It actually holds count of finished jobs by DJC. But I don\u0027t see any references which uses this counter.",
      "parentUuid": "1a622d24_e1a50848",
      "revId": "3dd38ef8a108839a4ba5e49c3fe8c96b0ec73ac8",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1a622d24_f47812f4",
        "filename": "mdsalutil/mdsalutil-api/src/main/java/org/opendaylight/genius/datastoreutils/DataStoreJobCoordinator.java",
        "patchSetId": 1
      },
      "lineNbr": 123,
      "author": {
        "id": 6177
      },
      "writtenOn": "2016-12-23T22:13:33Z",
      "side": 1,
      "message": "Peri, I think the intention was that jobs_pending counts the amount of jobs waiting in queue (and not currently handled) - Ideally, we want to see this counter\u003d0 (i.e. no jobs are waiting).\n\nRegarding jobs_cleared - I think what you\u0027re missing is how those counters work. When enabled, those counters changes  are repetitively printed to logs (if there was a change in the configurable period). In CSIT for example, we set that period to 1sec.\n\nIt\u0027s a wonderful tool to debug with - suggest you look at one of the CSIT logs, [1] for example.\n\nSample output:\n2016-12-23 11:47:50,406 | INFO  | CountersThread   | CountersDumperThread             | 276 - org.opendaylight.infrautils.counters-impl - 1.0.3.Boron-SR3 | dsjcc.jobs_cleared: +24, auc.arp_res_rcv_notification: +1, nsc.install_default_nat_flow: +1, auc.arp_res_rcv: +1, dsjcc.jobs_pending: 1  , auc.arp_req_rcv_notification: +4, auc.arp_req_rcv: +4",
      "parentUuid": "1a622d24_0763f4dc",
      "revId": "3dd38ef8a108839a4ba5e49c3fe8c96b0ec73ac8",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1a622d24_7080a446",
        "filename": "mdsalutil/mdsalutil-api/src/main/java/org/opendaylight/genius/datastoreutils/DataStoreJobCoordinator.java",
        "patchSetId": 1
      },
      "lineNbr": 307,
      "author": {
        "id": 5278
      },
      "writtenOn": "2016-12-19T07:15:20Z",
      "side": 1,
      "message": "The JobEntry in waitingEntries queue is removed due to queue.poll().\nAnd it.remove() in line no. 315 is required to remove the map otherwise enclosing for loops need to process empty map after all the tasks are executed for the given job key.",
      "revId": "3dd38ef8a108839a4ba5e49c3fe8c96b0ec73ac8",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    }
  ]
}